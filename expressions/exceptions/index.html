<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Exceptions - Pony Tutorial</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/highlight.css" rel="stylesheet">
  <link href="../../css/theme_extra.css" rel="stylesheet">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/highlight.pack.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Pony Tutorial</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>Getting started</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../..">Welcome!</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/what-you-need-to-start">What you need to start</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/installation">Installation</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/helloworld">Helloworld</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/how-it-works">How it works</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/whitespace">Whitespace</a>
                    
                </li>
            
        

    
        
        <span>Types</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/static-vs-dynamic">Static vs dynamic</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/classes">Classes</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/primitives">Primitives</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/actors">Actors</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/traits-and-interfaces">Traits and interfaces</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/type-aliases">Type aliases</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/type-expressions">Type expressions</a>
                    
                </li>
            
        

    
        
        <span>Capabilities</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/introduction">Introduction</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/guarantees">Guarantees</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/aliasing">Aliasing</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/combining-capabilities">Combining capabilities</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/passing-and-sharing">Passing and sharing</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/capability-subtyping">Capability subtyping</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/arrow-types">Arrow types</a>
                    
                </li>
            
        

    
        
        <span>Expressions</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../variables">Variables</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../infix-ops">Infix ops</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../control-structures">Control structures</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../methods">Methods</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Exceptions</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#throwing-and-catching">Throwing and catching</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#partial-functions">Partial functions</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#partial-constructors-and-behaviours">Partial constructors and behaviours</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#try-then-blocks">Try-then blocks</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#language-constructs-that-can-raise-errors">Language constructs that can raise errors</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#comparison-to-exceptions-in-other-languages">Comparison to exceptions in other languages</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../sugar">Sugar</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../object-literals">Object literals</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../partial-application">Partial application</a>
                    
                </li>
            
        

    
        
        <span>Actors</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/behaviours">Behaviours</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/capabilities">Capabilities</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/recover-and-consume">recover and consume</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/arrow-types">Arrow types</a>
                    
                </li>
            
        

    
        
        <span>Packages</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/package-system">Package system</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/builtin">Builtin</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/use-statement">Using a package</a>
                    
                </li>
            
        

    
        
        <span>Composition vs. inheritance</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../composition-inheritance/code-sharing">Code sharing</a>
                    
                </li>
            
        

    
        
        <span>Generics</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../generics/polymorphic-types">Polymorphic types</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../generics/polymorphic-methods">Polymorphic methods</a>
                    
                </li>
            
        

    
        
        <span>Pattern matching</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../pattern-matching/match">match-expression</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../pattern-matching/as">as-expression</a>
                    
                </li>
            
        

    
        
        <span>Platform</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../platform/platform">Platform</a>
                    
                </li>
            
        

    
        
        <span>Editor support</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../editor-plugins/plugins">Plugins</a>
                    
                </li>
            
        

    
        
        <span>Compiler options</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../compiler-clargs/clargs">Overview</a>
                    
                </li>
            
        

    
        
        <span>Patterns</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../patterns/patterns">Patterns</a>
                    
                </li>
            
        

    
        
        <span>Garbage collection</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../garbage-collection/garbage-collection">Garbage collection</a>
                    
                </li>
            
        

    
        
        <span>C-FFI</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../c-ffi/calling-c">Calling C programs</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../c-ffi/linking-c">Linking to C libraries</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../c-ffi/c-abi">Exposing a C-ABI</a>
                    
                </li>
            
        

    
        
        <span>Examples</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../examples/examples">Examples</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Exceptions</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <p>Pony provides a simple exception mechanism to aid error handling. At any point the code may decide to declare an <code>error</code> has occured. Code execution halts at that point and the call chain is unwound until the nearest enclosing error handler is found. This is all checked at compile time so errors cannot cause the whole program to crash.</p>
<h1 id="throwing-and-catching">Throwing and catching</h1>
<p>An error is raised with the command <code>error</code>. Error handlers are declared using the try-else syntax.</p>
<pre><code class="pony">try
  callA()
  if not callB() then error end
  callC()
else
  callD()
end
</code></pre>

<p>In the above code callA() will always be executed and so will callB(). If the result of callB() is true then we will proceed to callC() in the normal fashion and callD() will not then be executed.</p>
<p>However, if callB() returns false, then an error will be raised. At this point execution will stop and the nearest enclosing error handler will be found and executed. In this example that is our else block and so callD() will be executed.</p>
<p>In either case execution will then carry on will whatever code comes after the try <code>end</code>.</p>
<p><strong>Do I have to provide an error handler?</strong> No. The try block will catch any errors regardless. If you don't provide an error handler then no other action will be taken.</p>
<p>If you want to do something that might raise an error, but you don't care if it does you can just put in it a try block without an else.</p>
<pre><code class="pony">try
  call() // May raise an error
end
</code></pre>

<p><strong>Is there anything my error handler has to do?</strong> No. If you provide an error handler then it must contain some code, but it is entirely up to you what it does.</p>
<h1 id="partial-functions">Partial functions</h1>
<p>Pony does not require that all errors are caught immediately as in our previous examples. Instead functions can throw errors that are caught by whatever code calls them. These are called partial functions (this is a mathematical term meaning a function that does not have a defined result for all possible inputs, i.e. arguments). Partial functions <strong>must</strong> be marked as such in Pony with a <code>?</code>.</p>
<pre><code class="pony">fun factorial(x: I32): I32 ? =&gt;
  if x &lt; 0 then error end
  if x == 0 then
    1
  else
    x * factorial(x - 1)
  end
</code></pre>

<p>Everywhere that an error can be generated in Pony (an error command, a call to a partial function or certain built-in language constructs) must appear within a try block or a function that is marked as partial. This is checked at compile time, ensuring that an error cannot escape handling and crash the program.</p>
<h1 id="partial-constructors-and-behaviours">Partial constructors and behaviours</h1>
<p>Constructors may also be marked as partial. If a constructor raises an error then the construction is considered to have failed and the object under construction is discarded without ever being returned to the caller.</p>
<p>When an actor constructor is called the actor is created and a reference to it is returned immediately. However the constructor code is executed asynchronously at some later time. If an actor constructor were to raise an error it would already be too late to report this to the caller. For this reason constructors for actors may not be partial.</p>
<p>Behaviours are also executed asynchronously and so cannot be partial for the same reason.</p>
<h1 id="try-then-blocks">Try-then blocks</h1>
<p>In addition to an <code>else</code> error handler a try command can have a <code>then</code> block. This is executed after the rest of the try, whether or not an error is caught. Expanding our example from earlier:</p>
<pre><code class="pony">try
  callA()
  if not callB() then error end
  callC()
else
  callD()
then
  callE()
end
</code></pre>

<p>The callE() will always be excuted. If callB() returns true then the sequence executed is callA(), callB(), callC(), callE(). If callB() returns false then the sequence executed is callA(), callB(), callD(), callE().</p>
<p><strong>Do I have to have an else error handler to have a then block?</strong> No. You can have a try-then block without an else if you like.</p>
<p><strong>Will my then block really always be executed, even if I return inside the try?</strong> Yes, your <code>then</code> expression will <strong>always</strong> be executed when the try block is complete. The only way it won't be is if the try never completes (due to an inifinite loop), the machine is powered off or the process is killed (and then, maybe).</p>
<h1 id="language-constructs-that-can-raise-errors">Language constructs that can raise errors</h1>
<p>The only language construct that can raise an error, other than the error command or calling a partial method, is the <code>as</code> command. This converts the given value to the specified type, if it can be. If it can't then an error is raised. This means that the <code>as</code> command can only be used inside a try block or a partial method.</p>
<h1 id="comparison-to-exceptions-in-other-languages">Comparison to exceptions in other languages</h1>
<p>Pony exceptions behave very much the same as those in C++, Java, C#, Python and Ruby. The key difference is that Pony exceptions do not have a type or instance associated with them. This makes them the same as C++ exceptions would be if a fixed literal was always thrown, eg <code>throw 3;</code>. This difference simplifies exception handling for the programmer and allows for much better runtime error handling performance.</p>
<p>The <code>else</code> handler in a <code>try</code> expression is just like a <code>catch(...)</code> in C++, <code>catch(Exception e)</code> in Java or C#, <code>except:</code> in Python or <code>rescue</code> in Ruby. Since exceptions do not have types there is no need for handlers to specify types or to have multiple handlers in a single try block.</p>
<p>The <code>then</code> block in a <code>try</code> expression is just like a <code>finally</code> in Java, C# or Python and <code>ensure</code> in Ruby.</p>
<p>If required, error handlers can "rethrow" by using the <code>error</code> command within the handler.</p>

            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sugar" class="btn btn-neutral float-right" title="Sugar"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../methods" class="btn btn-neutral" title="Methods"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="../methods" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../sugar" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>