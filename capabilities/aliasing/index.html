<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Aliasing - Pony Tutorial</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/highlight.css" rel="stylesheet">
  <link href="../../css/theme_extra.css" rel="stylesheet">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/highlight.pack.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Pony Tutorial</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="../..">Home</a>
                
            </li>
        

    
        
            <span>Getting started</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../..">Welcome!</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../getting-started/what-you-need-to-start/">What you need to start</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../getting-started/installation/">Installation</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../getting-started/helloworld/">Helloworld</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../getting-started/how-it-works/">How it works</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../getting-started/whitespace/">Whitespace</a>
                    
                </li>
            
        

    
        
            <span>Types</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/static-vs-dynamic/">Static vs dynamic</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/classes/">Classes</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/primitives/">Primitives</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/actors/">Actors</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/traits-and-interfaces/">Traits and interfaces</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/type-aliases/">Type aliases</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../types/type-expressions/">Type expressions</a>
                    
                </li>
            
        

    
        
            <span>Capabilities</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../introduction/">Introduction</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../guarantees/">Guarantees</a>
                    
                </li>
            
                <li class="toctree-l2 current">
                    <a class="current" href="./">Aliasing</a>
                    
                        <ul>
                        
                            <li class="toctree-l3"><a href="#aliasing-and-deny-guarantees">Aliasing and deny guarantees</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#what-counts-as-making-an-alias">What counts as making an alias?</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#consuming-a-variable">Consuming a variable</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#destructive-read">Destructive read</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#ephemeral-types">Ephemeral types</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#alias-types">Alias types</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../combining-capabilities/">Combining capabilities</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../passing-and-sharing/">Passing and sharing</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../capability-subtyping/">Capability subtyping</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../arrow-types/">Arrow types</a>
                    
                </li>
            
        

    
        
            <span>Expressions</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/variables/">Variables</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/infix-ops/">Infix ops</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/control-structures/">Control structures</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/methods/">Methods</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/exceptions/">Exceptions</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/sugar/">Sugar</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/object-literals/">Object literals</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../expressions/partial-application/">Partial application</a>
                    
                </li>
            
        

    
        
            <span>Actors</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../actors/behaviours/">Behaviours</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../actors/capabilities/">Capabilities</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../actors/recover-and-consume/">recover and consume</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../actors/arrow-types/">Arrow types</a>
                    
                </li>
            
        

    
        
            <span>Packages</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../packages/package-system/">Package system</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../packages/builtin/">Builtin</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../packages/use-statement/">Using a package</a>
                    
                </li>
            
        

    
        
            <li class="toctree-l1 ">
                <a class="" href="../../composition-inheritance/code-sharing/">Composition vs. inheritance</a>
                
            </li>
        

    
        
            <span>Generics</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../generics/polymorphic-types/">Polymorphic types</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../generics/polymorphic-methods/">Polymorphic methods</a>
                    
                </li>
            
        

    
        
            <span>Pattern matching</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../pattern-matching/match/">match-expression</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../pattern-matching/as/">as-expression</a>
                    
                </li>
            
        

    
        
            <span>Platform</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../platform/platform/">Platform</a>
                    
                </li>
            
        

    
        
            <span>Editor support</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../editor-plugins/plugins/">Plugins</a>
                    
                </li>
            
        

    
        
            <span>Compiler options</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../compiler-clargs/clargs/">Overview</a>
                    
                </li>
            
        

    
        
            <span>Patterns</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../patterns/patterns/">Patterns</a>
                    
                </li>
            
        

    
        
            <span>Garbage collection</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../garbage-collection/garbage-collection/">Garbage collection</a>
                    
                </li>
            
        

    
        
            <span>C-FFI</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../c-ffi/calling-c/">Calling C programs</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../c-ffi/linking-c/">Linking to C libraries</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../c-ffi/c-abi/">Exposing a C-ABI</a>
                    
                </li>
            
        

    
        
            <span>Examples</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../examples/examples/">Examples</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Pony Tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        <li>Capabilities &raquo;</li>
      
    
    <li>Aliasing</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <p><strong>Aliasing</strong> means having more than one variable that points to the same object.</p>
<p>In most programming languages, aliasing is pretty simple. You just assign some variable to another variable, and there you go, you have an alias. The variable you assign to has the same type (or some supertype) as what's being assigned to it, and everything is fine.</p>
<p>In Pony, that works for some capabilities, but not all.</p>
<h1 id="aliasing-and-deny-guarantees">Aliasing and deny guarantees</h1>
<p>The reason for this is that <code>iso</code> capabilities deny other <code>iso</code> variables that point to the same object. That is, you can only have one <code>iso</code> variable pointing to any given object. The same goes for <code>trn</code>.</p>
<pre><code class="pony">fun test(a: Wombat iso) =&gt;
  var b: Wombat iso = a // Not allowed!
</code></pre>

<p>Here we have some function that gets passed an isolated Wombat. If we try to alias <code>a</code> by assigning it to <code>b</code>, we'll be breaking capability guarantees so the compiler will stop us.</p>
<p><strong>What can I alias an <code>iso</code> as?</strong> Since an <code>iso</code> says no other variable can be used by <em>any</em> actor to read from or write to that object, we can only create aliases to an <code>iso</code> that can neither read nor write. Fortunately, we've got a capability that does exactly that: <code>tag</code>. So we can do this and the compiler will be happy:</p>
<pre><code class="pony">fun test(a: Wombat iso) =&gt;
  var b: Wombat tag = a // Allowed!
</code></pre>

<p><strong>What about aliasing <code>trn</code>?</strong> Since a <code>trn</code> says no other variable can be used by <em>any</em> actor to write to that object, we need something that doesn't allow writing, but also doesn't prevent our <code>trn</code> variable from writing. Fortunately, weve got a capability that does that too: <code>box</code>. So we can do this and the compiler will be happy:</p>
<pre><code class="pony">fun test(a: Wombat trn) =&gt;
  var b: Wombat box = a // Allowed!
</code></pre>

<p><strong>What about aliasing other stuff?</strong> Everything else can be aliased as itself. So <code>ref</code> can be aliased as <code>ref</code>, <code>val</code> can be aliased as <code>val</code>, <code>box</code> can be aliased as <code>box</code> and <code>tag</code> can be aliased as <code>tag</code>.</p>
<h1 id="what-counts-as-making-an-alias">What counts as making an alias?</h1>
<p>There are two things that count as making an alias:</p>
<ol>
<li>When you <strong>assign</strong> a value to a variable. This could be a local variable or a field.</li>
<li>When you <strong>pass</strong> a value as an argument to a method.</li>
</ol>
<p>In both cases, you are making a new <em>name</em> for the object. This might be the name of a local variable, the name of a field, or the name of a parameter to a method.</p>
<h1 id="consuming-a-variable">Consuming a variable</h1>
<p>Sometimes, you want to <em>move</em> an object from one variable to another. In other words, you don't want to make a <em>new</em> name for the object, exactly, you want to move the object from some existing name to a different one.</p>
<p>You can do this by using consume. When you consume a variable you take the value out of it, effectively leaving the variable empty. No code can read from that variable again until a new value is written to it. Consuming a local variable or a parameter allows you to make an alias with the same type, even if it's an <code>iso</code> or <code>trn</code>. For example:</p>
<pre><code class="pony">fun test(a: Wombat iso) =&gt;
  var b: Wombat iso = consume a // Allowed!
</code></pre>

<p>The compiler is happy with that, because by consuming <code>a</code>, you've said the value can't be used again and the compiler will complain if you try to.</p>
<pre><code class="pony">fun test(a: Wombat iso) =&gt;
  var b: Wombat iso = consume a // Allowed!
  var c: Wombat tag = a // Not allowed!
</code></pre>

<p>Here's an example of that. When you try to assign <code>a</code> to <code>c</code>, the compiler will complain.</p>
<p><strong>Can I <code>consume</code> a field?</strong> Definitely not! Consuming something means it is empty, that is, it has no value. There's no way to be sure no other alias to the object will access that field. If we tried to access a field that was empty, we would crash. But there's a way to do what you want to do: <em>destructive read</em>.</p>
<h1 id="destructive-read">Destructive read</h1>
<p>There's another way to <em>move</em> a value from one name to another. Earlier, we talked about how assignment in Pony returns the <em>old</em> value of the left-hand side, rather than the new value. This is called <em>destructive read</em>, and we can use it to do what we want to do, even with fields.</p>
<pre><code class="pony">class Aardvark
  var buddy: Wombat iso

  fun test(a: Wombat iso) =&gt;
    var b: Wombat iso = buddy = consume a // Allowed!
</code></pre>

<p>Here, we consume <code>a</code>, assign it to the field <code>buddy</code>, and assign the <em>old</em> value of <code>buddy</code> to <code>b</code>.</p>
<p><strong>Why is it ok to destructively read fields when we can't consume them?</strong> Because when we do a destructive read, we assign to the field so it always has a value. Unlike <code>consume</code>, there's no time when the field is empty. That means it's safe and the compiler doesn't complain.</p>
<h1 id="ephemeral-types">Ephemeral types</h1>
<p>In Pony, every expression has a type. So what's the type of <code>consume a</code>? It's not the same type as <code>a</code>, because it might not be possible to alias <code>a</code>. Instead, it's an <strong>ephemeral</strong> type. That is, it's a type for a value that currently has no name (it might have a name through some other alias, but not the one we just consumed or destructively read).</p>
<p>To show a type is ephemeral, we put a <code>^</code> at the end. For example:</p>
<pre><code class="pony">fun test(a: Wombat iso): Wombat iso^ =&gt;
  consume a
</code></pre>

<p>Here, our function takes an isolated Wombat as a parameter, and returns an ephemeral isolated Wombat.</p>
<p>This is useful for dealing with <code>iso</code> and <code>trn</code> types, and for generic types, but it's also important for constructors. A constructor always returns an ephemeral type, because it's a new object.</p>
<h1 id="alias-types">Alias types</h1>
<p>For the same reason Pony has ephemeral types, it also has alias types. An alias type is a way of saying "whatever we can safely alias this thing as". It's only needed when dealing with generic types, which we'll discuss later.</p>
<p>We indicate an alias type by putting a <code>!</code> at the end. Here's an example:</p>
<pre><code class="pony">fun test(a: A) =&gt;
  var b: A! = a
</code></pre>

<p>Here, we're using <code>A</code> as a <strong>type variable</strong>, which we'll cover later. So <code>A!</code> means "an alias of whatever type <code>A</code> is".</p>
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../combining-capabilities/" class="btn btn-neutral float-right" title="Combining capabilities"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../guarantees/" class="btn btn-neutral" title="Guarantees"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="../guarantees/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../combining-capabilities/" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>

<!--
MkDocs version  : 0.12.2
Docs Build Date : 2015-05-24 17:14:43.937909
-->
</body>
</html>